{"version":3,"sources":["webpack:///./src/pages/Image/index.vue?1d8c","webpack:///src/pages/Image/index.vue","webpack:///./src/pages/Image/index.vue?6d1f","webpack:///./src/pages/Image/index.vue","webpack:///./src/pages/Image/index.vue?b713"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","slot","_v","on","changeCollect","model","value","reqParams","callback","$$v","$set","expression","staticStyle","$event","openDialog","_l","item","key","id","url","collect","_e","class","active","is_collected","toggleStatus","deleteImage","page","per_page","total","togglePage","dialogVisible","uploadUrl","uploadHeaders","handleUploadSuccess","imageUrl","staticRenderFns","name","data","images","$http","defaults","baseURL","Authorization","window","localStorage","getItem","created","getImages","methods","$message","success","result","setTimeout","$confirm","confirmButtonText","cancelButtonText","type","changedPage","component"],"mappings":"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","file":"js/chunk-40655f12.6d6fd1bb.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"image-page\"},[_c('el-card',[_c('div',{attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('my-bread',[_vm._v(\"素材管理\")])],1),_c('el-radio-group',{attrs:{\"size\":\"small\"},on:{\"change\":_vm.changeCollect},model:{value:(_vm.reqParams.collect),callback:function ($$v) {_vm.$set(_vm.reqParams, \"collect\", $$v)},expression:\"reqParams.collect\"}},[_c('el-radio-button',{attrs:{\"label\":false}},[_vm._v(\"全部\")]),_c('el-radio-button',{attrs:{\"label\":true}},[_vm._v(\"收藏\")])],1),_c('el-button',{staticStyle:{\"float\":\"right\"},attrs:{\"type\":\"success\",\"size\":\"small\"},on:{\"click\":function($event){return _vm.openDialog()}}},[_vm._v(\"添加素材\")]),_c('ul',{staticClass:\"img-list\"},_vm._l((_vm.images),function(item){return _c('li',{key:item.id,staticClass:\"img-item\"},[_c('img',{attrs:{\"src\":item.url,\"alt\":\"\"}}),(!_vm.reqParams.collect)?_c('p',{staticClass:\"action\"},[_c('span',{staticClass:\"el-icon-star-off\",class:{active:item.is_collected},on:{\"click\":function($event){return _vm.toggleStatus(item)}}}),_c('span',{staticClass:\"el-icon-delete\",on:{\"click\":function($event){return _vm.deleteImage(item.id)}}})]):_vm._e()])}),0),_c('el-pagination',{attrs:{\"background\":\"\",\"layout\":\"prev, pager, next\",\"current-page\":_vm.reqParams.page,\"page-size\":_vm.reqParams.per_page,\"total\":_vm.total},on:{\"current-change\":_vm.togglePage}})],1),_c('el-dialog',{attrs:{\"title\":\"添加素材\",\"append-to-body\":\"\",\"visible\":_vm.dialogVisible,\"width\":\"300px\"},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('el-upload',{staticClass:\"avatar-uploader\",attrs:{\"action\":_vm.uploadUrl,\"headers\":_vm.uploadHeaders,\"name\":\"image\",\"show-file-list\":false,\"on-success\":_vm.handleUploadSuccess}},[(_vm.imageUrl)?_c('img',{staticClass:\"avatar\",attrs:{\"src\":_vm.imageUrl}}):_c('i',{staticClass:\"el-icon-plus avatar-uploader-icon\"})])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class='image-page'>\r\n    <el-card>\r\n      <div slot=\"header\">\r\n        <my-bread>素材管理</my-bread>\r\n      </div>\r\n      <!-- 切换按钮 + 添加按钮 -->\r\n      <el-radio-group @change=\"changeCollect\"  v-model=\"reqParams.collect\" size=\"small\">\r\n        <el-radio-button :label=\"false\">全部</el-radio-button>\r\n        <el-radio-button :label=\"true\">收藏</el-radio-button>\r\n      </el-radio-group>\r\n      <el-button @click=\"openDialog()\" style=\"float:right\" type=\"success\" size=\"small\">添加素材</el-button>\r\n      <!-- 图片列表 -->\r\n      <ul class=\"img-list\">\r\n        <li class=\"img-item\" v-for=\"item in images\" :key=\"item.id\">\r\n          <img :src=\"item.url\" alt=\"\">\r\n          <p class=\"action\" v-if=\"!reqParams.collect\">\r\n            <span @click=\"toggleStatus(item)\" class=\"el-icon-star-off\" :class=\"{active:item.is_collected}\"></span>\r\n            <span @click=\"deleteImage(item.id)\" class=\"el-icon-delete\"></span>\r\n          </p>\r\n        </li>\r\n      </ul>\r\n      <!-- 分页组件 -->\r\n      <el-pagination\r\n        background\r\n        layout=\"prev, pager, next\"\r\n        @current-change=\"togglePage\"\r\n        :current-page=\"reqParams.page\"\r\n        :page-size=\"reqParams.per_page\"\r\n        :total=\"total\">\r\n      </el-pagination>\r\n    </el-card>\r\n    <!-- 对话框 -->\r\n    <el-dialog title=\"添加素材\" append-to-body :visible.sync=\"dialogVisible\" width=\"300px\">\r\n      <el-upload\r\n        class=\"avatar-uploader\"\r\n        :action=\"uploadUrl\"\r\n        :headers=\"uploadHeaders\"\r\n        name=\"image\"\r\n        :show-file-list=\"false\"\r\n        :on-success=\"handleUploadSuccess\">\r\n        <img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n        <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n      </el-upload>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'ImagePage',\r\n  data () {\r\n    return {\r\n      // 查询条件\r\n      reqParams: {\r\n        collect: false,\r\n        page: 1,\r\n        per_page: 12\r\n      },\r\n      // 图片列表+总体条数\r\n      images: [],\r\n      total: 0,\r\n      // 控制对话框\r\n      dialogVisible: false,\r\n      // 预览图地址\r\n      imageUrl: '',\r\n      // 上传图片地址\r\n      uploadUrl: this.$http.defaults.baseURL + '/mp/v1_0/user/images',\r\n      // 上传图片请求头\r\n      uploadHeaders: {\r\n        Authorization: 'Bearer ' + window.localStorage.getItem('token')\r\n      }\r\n    }\r\n  },\r\n  created () {\r\n    this.getImages()\r\n  },\r\n  methods: {\r\n    // 上传成功\r\n    handleUploadSuccess (result) {\r\n      // 1. 预览 + 提示\r\n      this.$message.success('上传素材成功')\r\n      this.imageUrl = result.data.url\r\n      // 2. 3s后关闭对话框，更新列表\r\n      window.setTimeout(() => {\r\n        this.dialogVisible = false\r\n        this.getImages()\r\n      }, 3000)\r\n    },\r\n    // 打开对话框\r\n    openDialog () {\r\n      // 清空预览图\r\n      this.imageUrl = ''\r\n      this.dialogVisible = true\r\n    },\r\n    // 删除素材\r\n    deleteImage (id) {\r\n      this.$confirm('此操作将永久删除该素材, 是否继续?', '温馨提示', {\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }).then(() => {\r\n        // 确认，删除请求\r\n        try {\r\n          this.$http.delete(`/mp/v1_0/user/images/${id}`)\r\n          this.$message.success('删除素材成功')\r\n          this.getImages()\r\n        } catch (e) {\r\n          this.$message.error('删除素材失败')\r\n        }\r\n      }).catch(() => {\r\n        // 取消，无操作\r\n      })\r\n    },\r\n    // 添加收藏&取消收藏\r\n    async toggleStatus (item) {\r\n      try {\r\n      // collect 你想修改的素材状态，和当前item.is_collected状态取反即可\r\n        const { data: { data } } = await this.$http.put(`/mp/v1_0/user/images/${item.id}`, { collect: !item.is_collected })\r\n        // 操作成功\r\n        this.$message.success(data.collect ? '添加收藏成功' : '取消收藏成功')\r\n        // 通过修改数据去驱动星星的颜色\r\n        item.is_collected = data.collect\r\n      } catch (e) {\r\n        this.$message.error('操作失败')\r\n      }\r\n    },\r\n    async getImages () {\r\n      const { data: { data } } = await this.$http.get('/mp/v1_0/user/images', { params: this.reqParams })\r\n      this.images = data.results\r\n      this.total = data.total_count\r\n    },\r\n    togglePage (changedPage) {\r\n      this.reqParams.page = changedPage\r\n      this.getImages()\r\n    },\r\n    changeCollect () {\r\n      // 切换全部与收藏\r\n      this.reqParams.page = 1\r\n      this.getImages()\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang='less'>\r\n.img-list {\r\n  list-style: none;\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  .img-item {\r\n    width: 180px;\r\n    height: 180px;\r\n    margin-right: 60px;\r\n    margin-bottom: 25px;\r\n    border:1px dashed #ddd;\r\n    position: relative;\r\n    img {\r\n      width: 100%;\r\n      height: 100%;\r\n    }\r\n    .action {\r\n      margin: 0;\r\n      position: absolute;\r\n      left: 0;\r\n      bottom: 0;\r\n      height: 30px;\r\n      line-height: 30px;\r\n      width: 100%;\r\n      background: rgba(0,0,0,.3);\r\n      color: #fff;\r\n      text-align: center;\r\n      span {\r\n        margin: 0 20px;\r\n        &.active {\r\n          color: red;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=bdc42862&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=bdc42862&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"bdc42862\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=bdc42862&scoped=true&lang=less&\""],"sourceRoot":""}